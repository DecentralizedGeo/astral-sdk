## **5.1 OnchainRegistrar Integration with AstralSDK**  
  *Description*: Complete the integration of the OnchainRegistrar with the AstralSDK class to fully support onchain location proof creation, verification, and revocation workflows.
   
   - *Sub-tasks*: 
     - [ ] Review the existing OnchainRegistrar implementation in src/eas/OnchainRegistrar.ts:
       - [ ] Understand the current functionalities and limitations
       - [ ] Ensure proper error handling is in place
       - [ ] Verify the correct contract interactions are configured
       - [ ] Check schema encoding and decoding processes

     - [ ] Update AstralSDK constructor to properly initialize OnchainRegistrar:
       - [ ] Add `private onchainRegistrar?: OnchainRegistrar` property to AstralSDK class
       - [ ] Update constructor to initialize OnchainRegistrar with proper config
       - [ ] Implement lazy initialization pattern for when provider/signer is not immediately available
       - [ ] Add debug logging for initialization process

     - [ ] Implement `ensureOnchainRegistrarInitialized` method in AstralSDK:
       - [ ] Create a private method that ensures OnchainRegistrar is initialized before use
       - [ ] Handle cases where a provider/signer is provided in options but not in constructor
       - [ ] Throw appropriate ValidationError if no provider/signer is available
       - [ ] Add debug logging for initialization

     - [ ] Complete `createOnchainLocationProof` method in AstralSDK:
       - [ ] Ensure OnchainRegistrar is initialized
       - [ ] Call buildLocationProof to create an unsigned proof
       - [ ] Extract chain information from options or use default
       - [ ] Call onchainRegistrar.registerOnchainLocationProof with the unsigned proof
       - [ ] Return the registered OnchainLocationProof with all required fields
       - [ ] Implement comprehensive error handling
       - [ ] Add debug logging for important steps

     - [ ] Implement `verifyOnchainLocationProof` method in AstralSDK:
       - [ ] Ensure OnchainRegistrar is initialized
       - [ ] Call onchainRegistrar.verifyOnchainLocationProof with the proof
       - [ ] Return a proper VerificationResult object with status and reason if invalid
       - [ ] Add debug logging for verification process
       - [ ] Implement comprehensive error handling

     - [ ] Implement `revokeOnchainLocationProof` method in AstralSDK:
       - [ ] Ensure OnchainRegistrar is initialized
       - [ ] Verify the proof is revocable before attempting revocation
       - [ ] Call onchainRegistrar.revokeOnchainLocationProof with the proof
       - [ ] Process and return the transaction result
       - [ ] Implement comprehensive error handling
       - [ ] Add debug logging for revocation process

     - [ ] Write comprehensive tests for onchain integration:
       - [ ] Create a mock provider and signer for testing
       - [ ] Test constructor initialization with various provider/signer combinations
       - [ ] Test createOnchainLocationProof with valid input
       - [ ] Test createOnchainLocationProof error handling
       - [ ] Test verifyOnchainLocationProof with valid and invalid proofs
       - [ ] Test revokeOnchainLocationProof functionality
       - [ ] Use dependency injection to test OnchainRegistrar independently

     - [ ] Update example files to demonstrate onchain workflow:
       - [ ] Update examples/onchain-registrar-test.ts to show complete workflow
       - [ ] Add appropriate comments explaining key steps
       - [ ] Test example with a real provider and signer if possible
       - [ ] Include error handling examples

     - [ ] Perform integration testing:
       - [ ] Test full onchain workflow against Sepolia testnet
       - [ ] Verify all transaction operations function correctly
       - [ ] Check that verification works for both valid and revoked proofs
       - [ ] Document any testnet requirements or configuration needs

     - [ ] Review and refine implementation:
       - [ ] Ensure clean separation between offchain and onchain workflows
       - [ ] Verify consistent error handling across all methods
       - [ ] Check for any API inconsistencies or gaps
       - [ ] Add or update JSDoc comments for all public methods
       - [ ] Run linting and fix any issues
       - [ ] Run TypeScript type checking and fix any issues

   - [ ] *Output*: A fully functional integration between AstralSDK and OnchainRegistrar, supporting the complete onchain workflow for location proofs.
   
   - *Technical considerations*: 
     - [ ] Maintain clear workflow separation between offchain and onchain methods
     - [ ] Ensure proper error propagation from OnchainRegistrar to AstralSDK
     - [ ] Consider gas estimation and transaction parameter overrides
     - [ ] Handle chain-specific configuration differences
     - [ ] Support both connected and disconnected states gracefully
     - [ ] Consider transaction confirmation strategies (wait for receipt vs return after submission)
     - [ ] Document chain requirements and limitations
     - [ ] Add appropriate warnings for testnet vs mainnet usage
     - [ ] Consider transaction retry mechanisms for failed operations
     - [ ] Add clear debugging and logging to help troubleshoot blockchain operations

   - [ ] Run linting: `pnpm run lint`
   - [ ] Run typechecking: `pnpm run typecheck`
   - [ ] Run tests: `pnpm run test`
   - [ ] Commit changes with descriptive message

Complete: ⬜️

Commit hash: <todo>

## Implementation Report:

[TODO]