{"id":"astral-sdk-00w","title":"Documentation: Location Protocol Specification v0.2","description":"## Overview\nCreate authoritative reference documentation for Location Protocol v0.2.\n\n**GitHub Issue:** https://github.com/DecentralizedGeo/astral-sdk/issues/44\n\n## Problem\nNo single authoritative specification document exists. Developers lack clear reference for schema requirements.\n\n## Technical Requirements\n\n### Required Fields (v0.2)\n| Field | Type | Description |\n|-------|------|-------------|\n| specVersion | uint8 | Protocol version (value: 1 for v0.2) |\n| srs | string | Spatial Reference System (e.g., \"EPSG:4326\") |\n| locationType | string | Data format (e.g., \"geojson-point\", \"wkt-polygon\") |\n| location | string | Actual location data |\n\n### Legacy v0.1 Support\n- v0.1 requires only: srs, locationType, location (no specVersion)\n- v0.1 schemas remain valid but non-conformant\n- Both versions can coexist in production\n\n### Document Structure\n```\ndocs/protocol/specification.md\n├── Introduction\n├── Version History\n├── Required Fields\n│   ├── specVersion\n│   ├── srs\n│   ├── locationType\n│   └── location\n├── Optional Fields\n│   ├── eventTimestamp\n│   ├── recipeType/recipePayload\n│   ├── mediaType/mediaData\n│   └── memo\n├── Schema Examples (v0.1 and v0.2)\n├── Migration Guide (v0.1 → v0.2)\n└── Validation Requirements\n```\n\n## Acceptance Criteria\n- [ ] Complete specification at `docs/protocol/specification.md`\n- [ ] Schema examples for both v0.1 and v0.2\n- [ ] Clear v0.1-to-v0.2 migration path\n- [ ] Validation requirements stated\n- [ ] Linked from main SDK documentation\n- [ ] Published to docs.astral.global\n\n## Dependencies\nNone - this is foundational documentation.\n\n## Enables\n- #42 Schema Validation Utility (references this spec)\n- #45 Custom Schemas Guide","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-18T13:53:55.997776Z","updated_at":"2025-12-18T13:56:02.990633Z","labels":["documentation"]}
{"id":"astral-sdk-2e8","title":"Custom Chain Support","description":"## Overview\nEnable developers to use the Astral SDK on any EVM chain with an EAS deployment.\n\n**GitHub Issue:** https://github.com/DecentralizedGeo/astral-sdk/issues/41\n\n## Problem\nThe SDK only supports hardcoded chains (Sepolia, Base, Arbitrum, Celo). Developers cannot use OP Mainnet or other EVM chains with EAS deployments without waiting for official support.\n\n## Technical Requirements\n\n### Configuration Addition\n```typescript\ninterface AstralSDKConfig {\n  // ... existing config\n  easContract?: string;  // Custom EAS contract address\n}\n```\n\n### Known EAS Contract Registry\n```typescript\n// src/eas/contracts.ts\nexport const EAS_CONTRACTS: Record\u003cnumber, string\u003e = {\n  1: \"0xA1207F3BBa224E2c9c3c6D5aF63D0eb1582Ce587\",      // Mainnet\n  10: \"0x4200000000000000000000000000000000000021\",     // OP Mainnet\n  8453: \"0x4200000000000000000000000000000000000021\",   // Base\n  42161: \"0xbD75f629A22Dc1ceD33dDA0b68c546A1c035c458\",  // Arbitrum\n  42220: \"0x72E1d8ccf5f0bc3e8B2f3bCC6c7fA2e3b22F8DD5\",  // Celo\n  11155111: \"0xC2679fBD37d54388Ce493F1DB75320D236e1815e\" // Sepolia\n};\n```\n\n### Implementation Flow\n1. Check if `easContract` is provided in config → use it directly\n2. Check if chainId exists in `EAS_CONTRACTS` → use known contract\n3. Neither → throw clear error with instructions\n\n### Error Messages\n```typescript\nthrow new ConfigurationError(\n  `Chain ${chainId} is not supported by default. ` +\n  `Please provide an 'easContract' address for chains with EAS deployments. ` +\n  `See: https://docs.attest.org/docs/developer-tools/eas-contracts`\n);\n```\n\n## Files to Modify\n- `src/core/types.ts` - Add easContract to config\n- `src/eas/contracts.ts` - Create EAS contract registry (new file)\n- `src/eas/chains.ts` - Update to use registry, support custom contracts\n- `src/eas/OnchainRegistrar.ts` - Use custom EAS contracts\n\n## Research Notes\n- ethers.js custom network handling patterns\n- Minimal chain metadata requirements beyond chainId\n- Reference: viem/wagmi custom chain patterns\n\n## Acceptance Criteria\n- [ ] OP Mainnet works with explicit easContract parameter\n- [ ] Any EVM chain with EAS deployment is supported\n- [ ] Backward compatible (existing chains use defaults)\n- [ ] Clear error messaging for unsupported chains\n- [ ] Existing test suite passes\n- [ ] New tests for custom chain scenarios\n\n## Dependencies\nNone - this is independent of schema work.\n\n## Enables\n- #46 Custom Chains Guide","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-18T13:52:41.869333Z","updated_at":"2025-12-18T13:56:02.640677Z","labels":["core","feature"]}
{"id":"astral-sdk-2xv","title":"E2E: Setup Anvil fork environment","description":"Set up local Anvil fork of Sepolia for E2E testing.\n\n## Prerequisites\n- Foundry installed: `curl -L https://foundry.paradigm.xyz | bash \u0026\u0026 foundryup`\n- Sepolia RPC URL in .env: `SEPOLIA_RPC_URL=https://sepolia.infura.io/v3/YOUR_KEY`\n\n## Deliverables\n\n### 1. examples/e2e/start-anvil.sh\n```bash\n#\\!/bin/bash\nset -e\nsource .env\nanvil --fork-url $SEPOLIA_RPC_URL --chain-id 31337 --block-time 1\n```\n\n### 2. examples/e2e/anvil-config.ts\n```typescript\nexport const ANVIL_CONFIG = {\n  rpcUrl: 'http://127.0.0.1:8545',\n  chainId: 31337,\n  // Anvil default accounts (10000 ETH each)\n  accounts: [\n    { address: '0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266', privateKey: '0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80' },\n  ],\n  // Sepolia EAS contracts (forked)\n  eas: '0xC2679fBD37d54388Ce493F1DB75320D236e1815e',\n  schemaRegistry: '0x0a7E2Ff54e76B8E6659aedc9103FB21c038050D0',\n};\n```\n\n## Verification\nRun `cast call 0xC2679fBD37d54388Ce493F1DB75320D236e1815e 'version()(string)' --rpc-url http://127.0.0.1:8545` to confirm EAS is accessible.\n\n## Time estimate: 2-3 minutes","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-19T12:57:48.285881Z","updated_at":"2025-12-19T14:48:04.09216Z","closed_at":"2025-12-19T14:48:04.09216Z","close_reason":"Deliverables complete: start-anvil.sh, anvil-config.ts, custom-schema.ts. TypeScript compiles successfully."}
{"id":"astral-sdk-4c2","title":"Export Standard Schema Constants","description":"## Overview\nExport reusable schema constants for the Location Protocol to simplify developer workflows.\n\n**GitHub Issue:** https://github.com/DecentralizedGeo/astral-sdk/issues/43\n\n## Problem\nDevelopers manually define schema configurations, which is error-prone and repetitive. No canonical schema constants are exported from the SDK.\n\n## Technical Requirements\n\n### File Structure\n```\nsrc/schemas/\n├── index.ts           # Main export module\n├── location-v1.ts     # v0.1 legacy schema constant\n└── location-v2.ts     # v0.2 schema (future)\n```\n\n### Schema Constant Structure\n```typescript\nexport const LOCATION_V1_SCHEMA: SchemaConfig = {\n  uid: \"0xba4171c92572b1e4f241d044c32cdf083be9fd946b8766977558ca6378c824e2\",\n  rawString: \"uint256 eventTimestamp, string srs, string locationType, string location, string[] recipeType, string[] recipePayload, string[] mediaType, string[] mediaData, string memo\",\n  version: 1,\n  networks: [\"sepolia\", \"base\", \"arbitrum\", \"celo\"]\n};\n```\n\n### Documentation\n- Comprehensive JSDoc for each constant\n- Deployment network information\n- Usage examples in comments\n\n## Acceptance Criteria\n- [ ] Export `LOCATION_V1_SCHEMA` with full JSDoc\n- [ ] Include deployment info and usage examples\n- [ ] Re-export from main package entry point (`import { LOCATION_V1_SCHEMA } from 'astral-sdk'`)\n- [ ] Compatible with multi-schema SDK support (#40)\n- [ ] Type-safe SchemaConfig interface\n\n## Dependencies\nNone - this is a foundation component.\n\n## Enables\n- #40 Multi-Schema Support","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-18T13:51:58.437145Z","updated_at":"2025-12-19T11:36:22.192701Z","closed_at":"2025-12-19T11:36:22.192701Z","close_reason":"Implemented and reviewed. Single clean commit ready for PR.","labels":["core","foundation"]}
{"id":"astral-sdk-63q","title":"E2E: Register onchain attestation on Anvil fork","description":"Register and verify an onchain attestation using the custom schema on Anvil.\n\n## Prerequisites\n- SDK configured with custom schema (bead ddx)\n- Anvil fork running\n\n## Deliverable: examples/e2e/onchain-test.ts\n\n```typescript\nimport { AstralSDK } from '../../src/core/AstralSDK';\nimport { ASSET_TRACKING_SCHEMA } from './custom-schema';\nimport { ANVIL_CONFIG } from './anvil-config';\nimport { createWalletClient, createPublicClient, http, parseAbi } from 'viem';\nimport { privateKeyToAccount } from 'viem/accounts';\nimport { foundry } from 'viem/chains';\n\nconst EAS_ABI = parseAbi([\n  'function getAttestation(bytes32 uid) view returns (tuple(bytes32 uid, bytes32 schema, uint64 time, uint64 expirationTime, uint64 revocationTime, bytes32 refUID, address attester, address recipient, bool revocable, bytes data))'\n]);\n\nasync function testOnchainAttestation() {\n  const account = privateKeyToAccount(ANVIL_CONFIG.accounts[0].privateKey);\n  \n  const walletClient = createWalletClient({\n    account,\n    chain: foundry,\n    transport: http(ANVIL_CONFIG.rpcUrl),\n  });\n\n  const publicClient = createPublicClient({\n    chain: foundry,\n    transport: http(ANVIL_CONFIG.rpcUrl),\n  });\n\n  const sdk = new AstralSDK({\n    walletClient,\n    defaultSchema: ASSET_TRACKING_SCHEMA,\n  });\n\n  // Step 1: Build unsigned attestation\n  const unsigned = await sdk.buildLocationAttestation({\n    locationType: 'geojson-point',\n    location: JSON.stringify({\n      type: 'Feature',\n      geometry: { type: 'Point', coordinates: [-73.9857, 40.7484] },\n      properties: {},\n    }),\n    assetId: 'ASSET-002',\n    owner: account.address,\n    timestamp: BigInt(Math.floor(Date.now() / 1000)),\n  });\n  console.log('✓ Built unsigned attestation');\n\n  // Step 2: Register onchain\n  const result = await sdk.registerOnchainLocationAttestation(unsigned, {\n    schema: ASSET_TRACKING_SCHEMA,\n  });\n  console.log('✓ Registered onchain, uid:', result.uid);\n\n  // Step 3: Query attestation from EAS contract\n  const attestation = await publicClient.readContract({\n    address: ANVIL_CONFIG.eas,\n    abi: EAS_ABI,\n    functionName: 'getAttestation',\n    args: [result.uid],\n  });\n  console.log('✓ Queried attestation from EAS');\n\n  // Step 4: Verify attestation data\n  console.assert(attestation.schema === ASSET_TRACKING_SCHEMA.uid, 'Schema UID should match');\n  console.assert(attestation.attester === account.address, 'Attester should match');\n  console.log('✓ Attestation data verified');\n\n  console.log('\\nOnchain attestation test passed!');\n  return result;\n}\n\ntestOnchainAttestation();\n```\n\n## Run\n```bash\nnpx tsx examples/e2e/onchain-test.ts\n```\n\n## Time estimate: 2-3 minutes","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-19T12:55:46.640664Z","updated_at":"2026-01-06T16:06:44.563137Z","closed_at":"2026-01-06T16:06:44.563137Z","close_reason":"onchain-test.ts created and committed (b9464f5)","dependencies":[{"issue_id":"astral-sdk-63q","depends_on_id":"astral-sdk-ddx","type":"blocks","created_at":"2025-12-19T12:55:58.00756Z","created_by":"daemon"}]}
{"id":"astral-sdk-8ps","title":"Documentation: Custom Schemas Guide","description":"## Overview\nEnable developers to create, deploy, and use custom EAS schemas without requiring team support.\n\n**GitHub Issue:** https://github.com/DecentralizedGeo/astral-sdk/issues/45\n**Addresses:** #30 (doc snippets), #32 (schema inconsistencies)\n\n## Problem\nDevelopers cannot easily create custom schemas that conform to Location Protocol. No guide exists for the end-to-end workflow.\n\n## Document Structure\n```\ndocs/guides/custom-schemas.md\n├── Why Custom Schemas?\n├── Location Protocol Requirements\n│   ├── Required Fields\n│   └── Supported Types\n├── Designing Your Schema\n├── Deploying to EAS\n│   ├── Via EASScan UI\n│   └── Programmatic Deployment\n├── Using with Astral SDK\n│   ├── Pre-registration\n│   └── Ad-hoc Usage\n├── Schema Validation\n├── Working Examples\n│   ├── Land Parcels Schema\n│   ├── Supply Chain Schema\n│   └── Event Locations Schema\n└── Troubleshooting\n```\n\n## Technical Content Requirements\n\n### Required Fields Reference\n```typescript\n// Minimum Location Protocol v0.2 conformant schema\nuint8 specVersion,     // Always 1 for v0.2\nstring srs,            // \"EPSG:4326\"\nstring locationType,   // \"geojson-point\", \"wkt-polygon\", etc.\nstring location        // The actual location data\n```\n\n### Supported EAS Types\n- Numeric: uint8, uint16, uint32, uint64, uint128, uint256\n- Data: address, bool, bytes, bytes32, string\n- Arrays: All types support arrays (e.g., string[], uint256[])\n\n### Example: Land Parcels Schema\n```typescript\nconst PARCEL_SCHEMA = {\n  uid: \"0x...\",  // After deployment\n  rawString: \"uint8 specVersion, string srs, string locationType, string location, string parcelId, uint256 area, address owner, string zoning\"\n};\n```\n\n### SDK Integration Example\n```typescript\nconst sdk = new AstralSDK({\n  schemas: [PARCEL_SCHEMA],\n  defaultSchema: PARCEL_SCHEMA\n});\n\nawait sdk.registerOnchainLocationAttestation({\n  location: parcelGeometry,\n  locationType: 'geojson-polygon',\n  // Custom fields\n  parcelId: 'APN-12345',\n  area: 5000,\n  owner: '0x...',\n  zoning: 'residential'\n});\n```\n\n## Acceptance Criteria\n- [ ] Complete guide at `docs/guides/custom-schemas.md`\n- [ ] Clear explanations throughout\n- [ ] Tested EAS deployment instructions\n- [ ] Working code examples for current SDK\n- [ ] Minimum 3 complete examples\n- [ ] Troubleshooting section\n- [ ] Linked from main documentation\n\n## Dependencies\n- astral-sdk-hrc (Multi-Schema Support)\n- astral-sdk-aw6 (Schema Validation Utility)\n- astral-sdk-00w (Protocol Specification v0.2)\n\n## Publication\nTarget: https://docs.astral.global/sdk/guides/custom-schemas","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-18T13:54:18.084058Z","updated_at":"2025-12-18T13:54:18.084058Z","labels":["documentation"],"dependencies":[{"issue_id":"astral-sdk-8ps","depends_on_id":"astral-sdk-hrc","type":"blocks","created_at":"2025-12-18T13:55:31.949833Z","created_by":"daemon"},{"issue_id":"astral-sdk-8ps","depends_on_id":"astral-sdk-aw6","type":"blocks","created_at":"2025-12-18T13:55:32.25174Z","created_by":"daemon"},{"issue_id":"astral-sdk-8ps","depends_on_id":"astral-sdk-00w","type":"blocks","created_at":"2025-12-18T13:55:32.422508Z","created_by":"daemon"}]}
{"id":"astral-sdk-9pd","title":"Fix Documentation Code Snippets and Schema Consistency","description":"## Overview\nAudit and fix all documentation code examples for accuracy and Location Protocol compliance.\n\n**GitHub Issues:** \n- https://github.com/DecentralizedGeo/astral-sdk/issues/30\n- https://github.com/DecentralizedGeo/astral-sdk/issues/32\n\n## Problem\n1. **#30**: Code examples use unsupported location formats (decimal degrees)\n2. **#32**: Inconsistent schema representation across documentation\n\n## Technical Requirements\n\n### Audit Scope\n- README.md\n- docs/*.md\n- All code examples in documentation\n- JSDoc examples in source code\n\n### Location Format Fixes\nReplace unsupported formats with currently supported ones:\n- ✗ `[40.7128, -74.0060]` (decimal degrees - not supported)\n- ✓ `{ type: 'Point', coordinates: [-74.0060, 40.7128] }` (GeoJSON)\n- ✓ `'POINT(-74.0060 40.7128)'` (WKT)\n\n### Schema Consistency\nAll examples must use correct base fields per Location Protocol:\n```typescript\n{\n  specVersion: 1,           // v0.2\n  srs: 'EPSG:4326',         // Required\n  locationType: 'geojson-point',  // Required\n  location: {...},          // Required\n  // Optional fields...\n}\n```\n\n### Supported Location Types Reference\nFrom https://docs.astral.global/sdk/#-supported-location-formats:\n- geojson-point, geojson-polygon, etc.\n- wkt-point, wkt-polygon, etc.\n- h3-index\n- coordinates-decimal (if supported)\n\n## Deliverables\n1. Comprehensive audit spreadsheet of all code examples\n2. PRs fixing each non-compliant example\n3. Verification that examples are copy-paste runnable\n\n## Acceptance Criteria\n- [ ] All code examples use supported location types\n- [ ] All examples show correct base schema fields\n- [ ] Examples are copy-paste executable\n- [ ] No TypeScript errors when following examples\n- [ ] Consistent formatting across all documentation\n\n## Dependencies\n- astral-sdk-00w (Protocol Specification v0.2) - for reference\n\n## Notes\nMuch of this may be addressed when writing #45 (Custom Schemas Guide) and #46 (Custom Chains Guide), but a dedicated audit ensures nothing is missed.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-18T13:55:10.021634Z","updated_at":"2025-12-18T13:55:10.021634Z","labels":["documentation"],"dependencies":[{"issue_id":"astral-sdk-9pd","depends_on_id":"astral-sdk-00w","type":"blocks","created_at":"2025-12-18T13:55:36.567943Z","created_by":"daemon"}]}
{"id":"astral-sdk-aw6","title":"Schema Validation Utility","description":"## Overview\nCreate a comprehensive schema validation tool to verify EAS schemas conform to Location Protocol v0.2 requirements.\n\n**GitHub Issue:** https://github.com/DecentralizedGeo/astral-sdk/issues/42\n\n## Problem\nDevelopers lack tooling to validate schemas before deployment. No way to verify Location Protocol conformance programmatically.\n\n## Technical Requirements\n\n### Function Signature\n```typescript\nfunction validateLocationProtocolSchema(rawSchema: string, options?: ValidationOptions): ValidationResult\n\ninterface ValidationResult {\n  valid: boolean;           // Overall validity\n  version: number;          // 0.1 or 0.2\n  conformant: boolean;      // Has all required LP fields\n  missing: string[];        // Missing required fields\n  errors: string[];         // Schema format errors\n  warnings: string[];       // Non-critical issues\n}\n```\n\n### Validation Checks\n1. **Location Protocol Conformance**: Verify required fields (`specVersion`, `srs`, `locationType`, `location`)\n2. **EAS Schema Format**: Check syntax, types, and structure\n3. **Dual-Mode Support**: Strict mode (throws ValidationError) and warn mode (returns results)\n4. **Legacy Support**: Handle v0.1 schemas (no specVersion) gracefully\n\n### Implementation Location\n- Create `src/utils/schemaValidation.ts`\n- Export from main package entry point\n\n## Acceptance Criteria\n- [ ] Validates v0.2 conformant schemas correctly\n- [ ] Identifies legacy v0.1 schemas (no specVersion)\n- [ ] Catches malformed EAS schema strings\n- [ ] Identifies missing required fields\n- [ ] Provides detailed, actionable error messages\n- [ ] Functions in both strict and warn modes\n- [ ] Exported as public SDK utility\n- [ ] Comprehensive test coverage\n\n## Dependencies\nNone - this is a foundation component.\n\n## Enables\n- #40 Multi-Schema Support\n- #45 Custom Schemas Guide","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-18T13:51:42.153179Z","updated_at":"2025-12-18T15:22:50.311265Z","closed_at":"2025-12-18T15:22:50.311267Z","labels":["core","foundation"],"comments":[{"id":1,"issue_id":"astral-sdk-aw6","author":"x25bd","text":"## Implementation Complete\n\nBranch: `feat/schema-validation-utility`\n\n### Commits\n- `40ce867` feat(utils): add Location Protocol schema validation utility\n- `e8b8320` perf(schemaValidation): optimize duplicate detection and expand type validation  \n- `73e9d19` test(schemaValidation): add comprehensive edge case tests\n\n### Deliverables\n- `src/utils/schemaValidation.ts` - Main implementation (400+ lines)\n- `test/utils/schemaValidation.test.ts` - 61 tests\n\n### Features Implemented\n- `validateLocationProtocolSchema()` - Main validation function\n- `parseSchemaString()` - Schema parser\n- `isLocationProtocolV2()` - Version detection helper\n- `getSchemaFieldNames()` - Field extraction helper\n\n### Review Feedback Addressed\n- O(n²) → O(n) duplicate detection\n- All bytes1-32 variants supported\n- Input length validation (10k limit)\n- Comprehensive edge case tests\n\nCloses GitHub #42","created_at":"2025-12-18T15:23:06Z"}]}
{"id":"astral-sdk-bfd","title":"E2E: Design custom v0.2 conformant schema","description":"Design a custom Location Protocol v0.2 conformant schema for testing.\n\n## Schema Design: Asset Tracking Schema\n\nA practical schema for tracking physical assets with location data.\n\n### Schema String\n```\nuint8 specVersion,string srs,string locationType,string location,string assetId,address owner,uint256 timestamp\n```\n\n### Field Definitions\n| Field | Type | Description |\n|-------|------|-------------|\n| specVersion | uint8 | Location Protocol version (always 1 for v0.2) |\n| srs | string | Spatial reference system (e.g., 'EPSG:4326') |\n| locationType | string | Format identifier (e.g., 'geojson-point') |\n| location | string | The actual location data |\n| assetId | string | Custom: unique asset identifier |\n| owner | address | Custom: asset owner's address |\n| timestamp | uint256 | Custom: Unix timestamp of record |\n\n## Deliverable: examples/e2e/custom-schema.ts\n\n```typescript\nimport { RuntimeSchemaConfig } from '../../src/core/types';\nimport { validateLocationProtocolSchema } from '../../src/utils/schemaValidation';\n\nexport const ASSET_TRACKING_SCHEMA_STRING = \n  'uint8 specVersion,string srs,string locationType,string location,string assetId,address owner,uint256 timestamp';\n\n// Validate before use\nconst validation = validateLocationProtocolSchema(ASSET_TRACKING_SCHEMA_STRING);\nif (\\!validation.conformant) {\n  throw new Error(`Schema not conformant: ${validation.missing.join(', ')}`);\n}\n\n// UID will be populated after deployment\nexport const ASSET_TRACKING_SCHEMA: RuntimeSchemaConfig = {\n  uid: '', // TODO: Fill after deployment (bead nyw)\n  rawString: ASSET_TRACKING_SCHEMA_STRING,\n};\n```\n\n## Time estimate: 2-3 minutes","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-19T12:55:21.671411Z","updated_at":"2025-12-19T14:48:04.094369Z","closed_at":"2025-12-19T14:48:04.094369Z","close_reason":"Deliverables complete: start-anvil.sh, anvil-config.ts, custom-schema.ts. TypeScript compiles successfully."}
{"id":"astral-sdk-ddx","title":"E2E: Configure SDK with custom schema","description":"Configure and test SDK initialization with the custom schema.\n\n## Prerequisites\n- Schema deployed with UID (bead nyw)\n\n## Deliverable: examples/e2e/sdk-config-test.ts\n\n```typescript\nimport { AstralSDK } from '../../src/core/AstralSDK';\nimport { ASSET_TRACKING_SCHEMA } from './custom-schema';\nimport { ANVIL_CONFIG } from './anvil-config';\n\nasync function testSDKConfig() {\n  // Test 1: Initialize with pre-registered schema\n  const sdk1 = new AstralSDK({\n    schemas: [ASSET_TRACKING_SCHEMA],\n  });\n  \n  const cache = sdk1.getSchemaCache();\n  console.assert(cache.has(ASSET_TRACKING_SCHEMA.uid), 'Schema should be cached');\n  console.log('✓ Schema pre-registered and cached');\n\n  // Test 2: Initialize with custom default schema\n  const sdk2 = new AstralSDK({\n    defaultSchema: ASSET_TRACKING_SCHEMA,\n  });\n  \n  const defaultSchema = sdk2.getDefaultSchema();\n  console.assert(defaultSchema.uid === ASSET_TRACKING_SCHEMA.uid, 'Default schema should match');\n  console.log('✓ Custom default schema configured');\n\n  // Test 3: Verify validation result\n  const validationResult = cache.get(ASSET_TRACKING_SCHEMA.uid);\n  console.assert(validationResult?.result.conformant, 'Schema should be conformant');\n  console.assert(validationResult?.result.version === 2, 'Should be v0.2');\n  console.log('✓ Schema validated as Location Protocol v0.2');\n\n  console.log('\\nAll SDK configuration tests passed!');\n}\n\ntestSDKConfig();\n```\n\n## Run\n```bash\nnpx tsx examples/e2e/sdk-config-test.ts\n```\n\n## Time estimate: 2-3 minutes","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-19T12:55:43.770914Z","updated_at":"2026-01-06T16:04:44.475194Z","closed_at":"2026-01-06T16:04:44.475194Z","close_reason":"sdk-config-test.ts created and committed (eec7bf4)","dependencies":[{"issue_id":"astral-sdk-ddx","depends_on_id":"astral-sdk-nyw","type":"blocks","created_at":"2025-12-19T12:55:57.784129Z","created_by":"daemon"}]}
{"id":"astral-sdk-hrc","title":"Multi-Schema Support with Validation Caching","description":"## Overview\nEnable developers to deploy domain-specific schemas and manage multiple schemas within applications.\n\n**GitHub Issue:** https://github.com/DecentralizedGeo/astral-sdk/issues/40\n**Closes:** #26 (Remove field payload restrictions)\n**Related:** #25, #31\n\n## Problem\nThe AstralSDK currently restricts each instance to a single schema. Developers need:\n- Domain-specific schemas (parcels, boundaries, POIs)\n- Multiple schemas simultaneously within applications\n- Custom Location Protocol-compliant schemas without waiting for SDK support\n\n## Technical Requirements\n\n### Configuration Additions\n```typescript\ninterface AstralSDKConfig {\n  // ... existing config\n  schemas?: SchemaConfig[];           // Pre-register multiple schemas\n  defaultSchema?: SchemaConfig;       // Fallback schema specification\n  strictSchemaValidation?: boolean;   // Controls error handling (default: false)\n}\n\ninterface SchemaConfig {\n  uid: string;           // EAS schema UID\n  rawString: string;     // EAS schema string\n}\n```\n\n### Per-Method Schema Override\n```typescript\n// All attestation methods accept optional schema parameter\nsdk.signOffchainLocationAttestation(unsigned, { schema: customSchema });\nsdk.registerOnchainLocationAttestation(unsigned, { schema: customSchema });\n```\n\n### Validation Strategy\n1. Validate pre-registered schemas during SDK initialization\n2. Validate ad-hoc schemas on first use, then cache results\n3. **Strict mode**: throws ValidationError for non-conformant schemas\n4. **Warn mode**: logs warnings but continues execution\n\n### Caching Implementation\n```typescript\nclass SchemaValidationCache {\n  private cache: Map\u003cstring, ValidationResult\u003e;\n  \n  validate(schema: SchemaConfig): ValidationResult;\n  invalidate(uid: string): void;\n  clear(): void;\n}\n```\n\n## Files to Modify\n- `src/core/types.ts` - Add SchemaConfig, update AstralSDKConfig\n- `src/core/AstralSDK.ts` - Schema management, caching, validation on init\n- `src/eas/OffchainSigner.ts` - Accept schema parameter\n- `src/eas/OnchainRegistrar.ts` - Accept schema parameter\n\n## Acceptance Criteria\n- [ ] Pre-registered schemas validated at SDK init\n- [ ] Ad-hoc schemas validated on first use\n- [ ] Cached validation reused for subsequent identical UIDs\n- [ ] Strict/warn modes behave as specified\n- [ ] Backward compatibility maintained (single schema still works)\n- [ ] Per-method schema override functional\n- [ ] Comprehensive test coverage\n\n## Dependencies\n- astral-sdk-aw6 (Schema Validation Utility)\n- astral-sdk-4c2 (Export Standard Schema Constants)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-18T13:52:16.967269Z","updated_at":"2025-12-19T12:07:39.725419Z","closed_at":"2025-12-19T12:07:39.725419Z","close_reason":"Implemented multi-schema support with validation caching, per-method schema override, and LOCATION_V1_SCHEMA integration","labels":["core","feature"],"dependencies":[{"issue_id":"astral-sdk-hrc","depends_on_id":"astral-sdk-aw6","type":"blocks","created_at":"2025-12-18T13:55:29.467599Z","created_by":"daemon"},{"issue_id":"astral-sdk-hrc","depends_on_id":"astral-sdk-4c2","type":"blocks","created_at":"2025-12-18T13:55:29.605027Z","created_by":"daemon"}]}
{"id":"astral-sdk-j7t","title":"E2E: Create offchain attestation with custom schema","description":"Create, sign, and verify an offchain attestation using the custom schema.\n\n## Prerequisites\n- SDK configured with custom schema (bead ddx)\n\n## Deliverable: examples/e2e/offchain-test.ts\n\n```typescript\nimport { AstralSDK } from '../../src/core/AstralSDK';\nimport { ASSET_TRACKING_SCHEMA } from './custom-schema';\nimport { ANVIL_CONFIG } from './anvil-config';\nimport { createWalletClient, http } from 'viem';\nimport { privateKeyToAccount } from 'viem/accounts';\nimport { foundry } from 'viem/chains';\n\nasync function testOffchainAttestation() {\n  const account = privateKeyToAccount(ANVIL_CONFIG.accounts[0].privateKey);\n  \n  const walletClient = createWalletClient({\n    account,\n    chain: foundry,\n    transport: http(ANVIL_CONFIG.rpcUrl),\n  });\n\n  const sdk = new AstralSDK({\n    walletClient,\n    defaultSchema: ASSET_TRACKING_SCHEMA,\n  });\n\n  // Step 1: Build unsigned attestation with custom fields\n  const unsigned = await sdk.buildLocationAttestation({\n    locationType: 'geojson-point',\n    location: JSON.stringify({\n      type: 'Feature',\n      geometry: { type: 'Point', coordinates: [-122.4194, 37.7749] },\n      properties: {},\n    }),\n    // Custom fields for asset tracking schema\n    assetId: 'ASSET-001',\n    owner: account.address,\n    timestamp: BigInt(Math.floor(Date.now() / 1000)),\n  });\n  console.log('✓ Built unsigned attestation');\n\n  // Step 2: Sign with custom schema\n  const signed = await sdk.signOffchainLocationAttestation(unsigned, {\n    schema: ASSET_TRACKING_SCHEMA,\n  });\n  console.log('✓ Signed attestation, sig:', signed.signature.slice(0, 20) + '...');\n\n  // Step 3: Verify signature\n  const isValid = await sdk.verifyOffchainLocationAttestation(signed);\n  console.assert(isValid, 'Signature should be valid');\n  console.log('✓ Signature verified');\n\n  // Step 4: Verify custom fields present\n  console.assert(signed.data.assetId === 'ASSET-001', 'assetId should match');\n  console.log('✓ Custom fields preserved');\n\n  console.log('\\nOffchain attestation test passed!');\n  return signed;\n}\n\ntestOffchainAttestation();\n```\n\n## Run\n```bash\nnpx tsx examples/e2e/offchain-test.ts\n```\n\n## Time estimate: 2-3 minutes","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-19T12:55:45.215048Z","updated_at":"2026-01-06T16:08:34.464902Z","closed_at":"2026-01-06T16:08:34.464902Z","close_reason":"offchain-test.ts created and committed (42eab20)","dependencies":[{"issue_id":"astral-sdk-j7t","depends_on_id":"astral-sdk-ddx","type":"blocks","created_at":"2025-12-19T12:55:57.901702Z","created_by":"daemon"}]}
{"id":"astral-sdk-nyw","title":"E2E: Deploy custom schema to local Anvil fork","description":"Deploy the custom schema to the local Anvil fork using the EAS SchemaRegistry.\n\n## Prerequisites\n- Anvil fork running (bead 2xv)\n- Schema defined (bead bfd)\n\n## SchemaRegistry Interface\n```solidity\nfunction register(string schema, address resolver, bool revocable) returns (bytes32 uid)\n```\n\n## Deliverable: examples/e2e/deploy-schema.ts\n\n```typescript\nimport { createWalletClient, http, parseAbi } from 'viem';\nimport { privateKeyToAccount } from 'viem/accounts';\nimport { foundry } from 'viem/chains';\nimport { ANVIL_CONFIG } from './anvil-config';\nimport { ASSET_TRACKING_SCHEMA_STRING } from './custom-schema';\n\nconst SCHEMA_REGISTRY_ABI = parseAbi([\n  'function register(string schema, address resolver, bool revocable) returns (bytes32)'\n]);\n\nasync function deploySchema() {\n  const account = privateKeyToAccount(ANVIL_CONFIG.accounts[0].privateKey);\n  \n  const client = createWalletClient({\n    account,\n    chain: foundry,\n    transport: http(ANVIL_CONFIG.rpcUrl),\n  });\n\n  const hash = await client.writeContract({\n    address: ANVIL_CONFIG.schemaRegistry,\n    abi: SCHEMA_REGISTRY_ABI,\n    functionName: 'register',\n    args: [\n      ASSET_TRACKING_SCHEMA_STRING,\n      '0x0000000000000000000000000000000000000000', // No resolver\n      true, // Revocable\n    ],\n  });\n\n  console.log('Schema registered, tx:', hash);\n  // Get UID from tx receipt logs\n}\n\ndeploySchema();\n```\n\n## Run\n```bash\nnpx tsx examples/e2e/deploy-schema.ts\n```\n\n## Output\nUpdate `ASSET_TRACKING_SCHEMA.uid` in custom-schema.ts with the returned UID.\n\n## Time estimate: 2-3 minutes","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-19T12:55:42.580212Z","updated_at":"2025-12-19T18:34:35.574739Z","closed_at":"2025-12-19T18:34:35.574739Z","close_reason":"deploy-schema.ts created and committed (7fc1a0f)","dependencies":[{"issue_id":"astral-sdk-nyw","depends_on_id":"astral-sdk-bfd","type":"blocks","created_at":"2025-12-19T12:55:57.639052Z","created_by":"daemon"},{"issue_id":"astral-sdk-nyw","depends_on_id":"astral-sdk-2xv","type":"blocks","created_at":"2025-12-19T12:57:56.300113Z","created_by":"daemon"}]}
{"id":"astral-sdk-ovv","title":"Documentation: Custom Chains Guide","description":"## Overview\nEnable developers to use Astral SDK on any EVM chain with an EAS deployment.\n\n**GitHub Issue:** https://github.com/DecentralizedGeo/astral-sdk/issues/46\n\n## Problem\nDocumentation only covers officially supported chains. No guidance for using OP Mainnet, custom L2s, or other EVM chains with EAS.\n\n## Document Structure\n```\ndocs/guides/custom-chains.md\n├── Overview\n├── Prerequisites\n│   ├── EAS Contract Deployment\n│   ├── Schema Registry\n│   └── LP Schema Registration\n├── Finding EAS Contract Addresses\n├── SDK Configuration\n├── Working Examples\n│   ├── OP Mainnet\n│   └── Custom L2\n├── Supported Networks Reference\n└── Troubleshooting\n```\n\n## Technical Content Requirements\n\n### Prerequisites Checklist\n1. Chain has EAS contracts deployed\n2. Schema registry is available\n3. Location Protocol schema is registered (or deploy your own)\n\n### EAS Contract Reference Table\n| Network | Chain ID | EAS Contract |\n|---------|----------|--------------|\n| Ethereum | 1 | 0xA1207F3BBa224E2c9c3c6D5aF63D0eb1582Ce587 |\n| OP Mainnet | 10 | 0x4200000000000000000000000000000000000021 |\n| Base | 8453 | 0x4200000000000000000000000000000000000021 |\n| Arbitrum | 42161 | 0xbD75f629A22Dc1ceD33dDA0b68c546A1c035c458 |\n| Celo | 42220 | 0x72E1d8ccf5f0bc3e8B2f3bCC6c7fA2e3b22F8DD5 |\n| Sepolia | 11155111 | 0xC2679fBD37d54388Ce493F1DB75320D236e1815e |\n\n### OP Mainnet Example\n```typescript\nimport { AstralSDK } from 'astral-sdk';\n\nconst sdk = new AstralSDK({\n  provider: window.ethereum,\n  chainId: 10,  // OP Mainnet\n  easContract: '0x4200000000000000000000000000000000000021'\n});\n\nconst attestation = await sdk.registerOnchainLocationAttestation({\n  location: { type: 'Point', coordinates: [-122.4194, 37.7749] },\n  locationType: 'geojson-point',\n  memo: 'Created on OP Mainnet'\n});\n```\n\n### Troubleshooting Section\n- Chain compatibility errors\n- Transaction failures\n- Schema UID mismatches across chains\n- RPC connectivity issues\n\n## Acceptance Criteria\n- [ ] Complete guide at `docs/guides/custom-chains.md`\n- [ ] All sections with clear instructions\n- [ ] OP Mainnet example tested and working\n- [ ] EAS deployments table complete and verified\n- [ ] Troubleshooting covers common issues\n- [ ] Cross-linked with other documentation\n\n## Dependencies\n- astral-sdk-2e8 (Custom Chain Support)\n\n## Publication\nTarget: https://docs.astral.global/sdk/guides/custom-chains","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-18T13:54:42.049865Z","updated_at":"2025-12-18T13:54:42.049865Z","labels":["documentation"],"dependencies":[{"issue_id":"astral-sdk-ovv","depends_on_id":"astral-sdk-2e8","type":"blocks","created_at":"2025-12-18T13:55:34.746843Z","created_by":"daemon"}]}
{"id":"astral-sdk-t5k","title":"Fix Recipe Type and Payload Fields","description":"## Overview\nEnable recipeType and recipePayload fields in location attestations.\n\n**GitHub Issue:** https://github.com/DecentralizedGeo/astral-sdk/issues/25\n**Related:** #24 (tracking issue), #40 (may partially address)\n\n## Problem\nThe `recipeType` and `recipePayload` fields are:\n- Documented as supported\n- Present in deployed EAS schemas across all networks\n- But NOT available in the TypeScript interface\n- Values revert to empty arrays even when provided\n\n## Root Cause Analysis\nThe `LocationAttestationInput` interface in `src/core/types.ts` omits these fields. A code comment notes they remain \"unimplemented in version 0.1\".\n\n## Technical Requirements\n\n### Update Type Interface\n```typescript\n// src/core/types.ts\ninterface LocationAttestationInput {\n  // ... existing fields\n  recipeType?: string[];    // Add this\n  recipePayload?: string[]; // Add this\n}\n```\n\n### Update Schema Encoder\nEnsure `src/eas/SchemaEncoder.ts` properly encodes these fields when provided.\n\n### Update Attestation Flow\n- `OffchainSigner.ts` - Include recipe fields in typed data\n- `OnchainRegistrar.ts` - Include recipe fields in attestation data\n\n## Testing Requirements\n```typescript\nconst attestation = await sdk.signOffchainLocationAttestation({\n  location: {...},\n  locationType: 'geojson-point',\n  recipeType: ['zkProof', 'gpsSignature'],\n  recipePayload: ['0x...proof1', '0x...proof2']\n});\n\nexpect(attestation.recipeType).toEqual(['zkProof', 'gpsSignature']);\nexpect(attestation.recipePayload).toEqual(['0x...proof1', '0x...proof2']);\n```\n\n## Acceptance Criteria\n- [ ] TypeScript compiles when including recipeType/recipePayload\n- [ ] User-provided values persist through attestation flow\n- [ ] Works for both onchain and offchain attestations\n- [ ] Empty arrays used as default when not provided (backward compatible)\n- [ ] Test coverage for recipe field scenarios\n\n## Dependencies\nNone - can be done independently.\n\n## Notes\nThis may be fully addressed by #40 (Multi-Schema Support) if custom schemas allow arbitrary fields. However, for the standard Location Protocol schema, these fields should work out of the box.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-18T13:53:09.393786Z","updated_at":"2025-12-18T13:53:09.393786Z","labels":["bugfix"]}
{"id":"astral-sdk-ttu","title":"E2E: Run full integration suite","description":"Run all E2E tests together and produce a summary report.\n\n## Prerequisites\n- All previous beads complete\n- Anvil fork running\n\n## Deliverable: examples/e2e/run-all.ts\n\n```typescript\nimport { execSync } from 'child_process';\n\nasync function runE2ESuite() {\n  console.log('='.repeat(60));\n  console.log('ASTRAL SDK - Multi-Schema E2E Integration Suite');\n  console.log('='.repeat(60));\n  \n  const tests = [\n    { name: 'SDK Configuration', file: 'sdk-config-test.ts' },\n    { name: 'Offchain Attestation', file: 'offchain-test.ts' },\n    { name: 'Onchain Attestation', file: 'onchain-test.ts' },\n  ];\n  \n  const results: { name: string; passed: boolean; error?: string }[] = [];\n  \n  for (const test of tests) {\n    console.log(`\\n▶ Running: ${test.name}`);\n    try {\n      execSync(`npx tsx examples/e2e/${test.file}`, { stdio: 'inherit' });\n      results.push({ name: test.name, passed: true });\n    } catch (e) {\n      results.push({ name: test.name, passed: false, error: String(e) });\n    }\n  }\n  \n  // Summary\n  console.log('\\n' + '='.repeat(60));\n  console.log('SUMMARY');\n  console.log('='.repeat(60));\n  for (const r of results) {\n    console.log(`${r.passed ? '✓' : '✗'} ${r.name}`);\n  }\n  \n  const allPassed = results.every(r =\u003e r.passed);\n  console.log(`\\nResult: ${allPassed ? 'ALL TESTS PASSED ✓' : 'SOME TESTS FAILED ✗'}`);\n  process.exit(allPassed ? 0 : 1);\n}\n\nrunE2ESuite();\n```\n\n## Run\n```bash\n# Start Anvil in background first\n./examples/e2e/start-anvil.sh \u0026\n\n# Deploy schema (one-time)\nnpx tsx examples/e2e/deploy-schema.ts\n\n# Run full suite\nnpx tsx examples/e2e/run-all.ts\n```\n\n## Time estimate: 2-3 minutes","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-19T12:55:47.74081Z","updated_at":"2026-01-06T16:10:29.244609Z","closed_at":"2026-01-06T16:10:29.244609Z","close_reason":"run-all.ts created and committed (6980ff0)","dependencies":[{"issue_id":"astral-sdk-ttu","depends_on_id":"astral-sdk-j7t","type":"blocks","created_at":"2025-12-19T12:55:58.115141Z","created_by":"daemon"},{"issue_id":"astral-sdk-ttu","depends_on_id":"astral-sdk-63q","type":"blocks","created_at":"2025-12-19T12:55:58.220081Z","created_by":"daemon"}]}
{"id":"astral-sdk-ztm","title":"Fix Media Attachments Support","description":"## Overview\nFix media attachment processing and expand supported media types.\n\n**GitHub Issue:** https://github.com/DecentralizedGeo/astral-sdk/issues/31\n\n## Problem\n1. Media attachments result in empty `mediaType` and `mediaData` arrays\n2. Only `image/jpeg` and `image/png` are supported\n3. No support for: audio, video, IPFS CIDs, or other formats\n4. Throws EXTENSION_ERROR for unsupported types\n\n## Current Error\n```\nEXTENSION_ERROR: No extension found for media type: ipfs/cid\navailableExtensions: ['image/jpeg', 'image/png']\n```\n\n## Technical Requirements\n\n### Expand Media Extensions\nAdd to `src/extensions/media/builtins/`:\n- `audio.ts` - MP3, WAV, OGG, AAC support\n- `video.ts` - MP4, MOV, WEBM support  \n- `ipfs.ts` - IPFS CID references (NEW)\n\n### IPFS CID Extension\n```typescript\n// src/extensions/media/builtins/ipfs.ts\nexport const IPFSExtension: MediaTypeExtension = {\n  type: 'ipfs/cid',\n  validate: (data: string) =\u003e isValidCID(data),\n  encode: (data: string) =\u003e data, // CIDs are already strings\n  decode: (data: string) =\u003e data,\n};\n```\n\n### Fix Attachment Processing\nDebug and fix the flow in:\n- `src/core/AstralSDK.ts` - Media input processing\n- Ensure MediaInput properly populates attestation fields\n\n### MediaInput Interface\n```typescript\ninterface MediaInput {\n  type: string;  // MIME type or 'ipfs/cid'\n  data: string;  // Base64 encoded or CID\n}\n```\n\n## Files to Modify\n- `src/extensions/media/index.ts` - Register new extensions\n- `src/extensions/media/builtins/audio.ts` - Already exists, verify working\n- `src/extensions/media/builtins/video.ts` - Already exists, verify working\n- `src/extensions/media/builtins/ipfs.ts` - NEW\n- `src/core/AstralSDK.ts` - Fix media processing flow\n\n## Acceptance Criteria\n- [ ] Image attachments work (JPEG, PNG, GIF, TIFF)\n- [ ] Audio attachments work (MP3, WAV, OGG, AAC)\n- [ ] Video attachments work (MP4, MOV)\n- [ ] IPFS CID references work\n- [ ] mediaType and mediaData arrays properly populated\n- [ ] Clear error messages for truly unsupported types\n- [ ] Test coverage for each media type\n\n## Dependencies\nNone - can be done independently.\n\n## Priority Note\nIPFS CID support is high value - enables referencing large files without embedding them in attestations.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-18T13:53:30.402765Z","updated_at":"2025-12-18T13:53:30.402765Z","labels":["bugfix"]}
